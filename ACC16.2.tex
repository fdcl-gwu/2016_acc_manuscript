%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%2345678901234567890123456789012345678901234567890123456789012345678901234567890
%        1         2         3         4         5         6         7         8

\documentclass[letterpaper, 10 pt, conference]{ieeeconf}  % Comment this line out if you need a4paper
%\documentclass[a4paper, 10pt, conference]{ieeeconf}      % Use this line for a4 paper
\IEEEoverridecommandlockouts                              % This command is only needed if 
                                                          % you want to use the \thanks command
\overrideIEEEmargins                                      % Needed to meet printer requirements.

% See the \addtolength command later in the file to balance the column lengths
% on the last page of the document

\usepackage{ieee_packages,graphicx}
\newcommand{\squeezeup}{\vspace{-2.5mm}}

\newcommand{\EditTL}[1]{{\color{red}\protect #1}}
%\renewcommand{\EditTL}[1]{{\protect #1}}

\newtheorem{definition}{Definition}
\newtheorem{lem}{Lemma}
\newtheorem{prop}{Proposition}
\newtheorem{cor}{Corollary}
\newtheorem{remark}{Remark}

\title{\LARGE \bf
Geometric Adaptive Control of Attitude Dynamics on $\SO$\\ with State Inequality Constraints}

\author{Shankar Kulumani, Christopher Poole, and Taeyoung Lee
\thanks{Shankar Kulumani, Christopher Poole, Taeyoung Lee, Mechanical and Aerospace Engineering, George Washington University, Washington DC 20052 {\tt \{skulumani,poolec,tylee\}@gwu.edu}}
\thanks{This research has been supported in part by NSF under the grants CMMI-1243000, CMMI-1335008, and CNS-1337722.}
}

\begin{document}
\allowdisplaybreaks

\maketitle
\thispagestyle{empty}
\pagestyle{empty}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{abstract}
This paper presents a new geometric adaptive control system with state inequality constraints for the attitude dynamics of a rigid body. 
The control system is designed such that the desired attitude is asymptotically stabilized, while the controlled attitude trajectory avoids undesired regions defined by an inequality constraint. 
In addition, we develop an adaptive update law that enables attitude stabilization in the presence of unknown disturbances. 
The attitude dynamics and the proposed control systems are developed on the special orthogonal group such that singularities and ambiguities of other attitude parameterizations, such as Euler angles and quaternions are completely avoided. 
The effectiveness of the proposed control system is demonstrated through numerical simulations and experimental results.
\end{abstract}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Introduction}\label{sec:intro}

Rigid body attitude control is an important problem for aerospace vehicles, ground and underwater vehicles, as well as robotic systems~\cite{hughes2004}.
One distinctive feature of the attitude dynamics of rigid bodies is that it evolves on a nonlinear manifold.
The three-dimensional special orthogonal group, or \( \SO \), is the set of \( 3 \times 3 \) orthogonal matrices whose determinant is one.
This configuration space is non-Euclidean and yields unique stability properties which are not observable on a linear space.
For example, it is impossible to achieve global attitude stabilization using continuous time-invariant feedback~\cite{bhat2000}.

% introduce concept of state inequality constraints and how it creates a nonconvex region 
% mention applicability of this for spacecraft maneuvers, spherical air bearing testing, hardware limitations
Many physical rigid body systems must perform large angular slews in the presence of state constraints.
For example, autonomous spacecraft or aerial systems are typically equipped with sensitive optical payloads, such as infrared or interferometric sensors.
These systems require retargeting while avoiding direct exposure to sunlight or other bright objects.
%Determining a satisfactory attitude control maneuver in the presence of state constraints is a challenging task.
The removal of constrained regions from the rotational configuration space results in a \textit{nonconvex} region.
The attitude control problem in the absence of constraints has been extensively studied~\cite{bullo2004,MayTeePaCC11,LEEITAC15}.
However, the attitude control problem in the presence of constraints has received much less attention.

% discuss how previous papers (mcinnes and lee/meshabi) have short comings
Several approaches have been developed to treat the attitude control problem in the presence of constraints.
A conceptually straightforward approach is used in~\cite{hablani1999} to determine feasible attitude trajectories prior to implementation.
The algorithm determines an intermediate point such that an unconstrained maneuver can be calculated for each sub-interval.
In this manner it is possible to accomplish constraint avoidance by linking several intermediary unconstrained maneuvers.
While this method is conceptually simple, it is difficult to generalize for an arbitrary number of constraints.

The approach in~\cite{frazzoli2001} involves the use of randomized motion planning algorithms to solve the constrained attitude control problem.
A random iterative search is conducted to determine a path through a directed graph such that a given cost functional is minimized.
However, the random search approach can only stochastically guarantee attitude convergence.
Typically, very large graphs are required which are ill-suited to on-board implementation or in scenarios that require agile maneuvers.

Model predictive control for spacecraft attitude dynamics is studied in~\cite{guiggiani2014,kalabic2014,gupta2015}.
This approach relies on linear or non-linear state prediction to repeatedly solve a finite time constrained optimal control problem.
The necessary conditions for optimality are continually computed over a receding finite horizon using a direct method. 
As a result, these methods are also computationally expensive.
  
% MORE DETAIL ON CONTRIBUTIONS 
% EXPLICITLY STATE - first time for constraints to be incorportated on SO(3) with barrier function
% Consider adaptive control which allows for stabilization in the presence of uncertain terms
% Benefits over previous approach -
% Developed on SO(3) - avoids issues of singularities and ambiguities of quaternion approach
% Geometric approach - requires a priori calculation of trajectory. not robust to uncertainties or changes in configuraiton
% Random/Graph approach -computationally expensive. requires a priori calculation of trajectory

% Previous potential function approach - developed using att parameterizations - singularities/ambiguities
Artificial potential functions are commonly used to handle kinematic constraints for a wide range of problems in robotics~\cite{rimon1992}.
The goal is the design of attractive and repulsive terms which drive the system toward or away from a certain state, respectively.
More specifically, artificial potential functions have previously been applied to the spacecraft attitude control problem in~\cite{lee2011b,mcinnes1994}.
However, both of these approaches were developed using attitude parameterizations, namely Euler angles and quaternions, and as such, they are limited by singularities or ambiguities.

This paper is focused on developing an adaptive attitude control scheme in the presence of attitude inequality constraints on \(\SO\).
We apply a potential function based approach directly on the nonlinear manifold \(\SO\). 
We also formulate an adaptive update law to enable attitude convergence in the presence of uncertain disturbances.
The stability of the proposed control systems is verified via mathematically rigorous Lyapunov analysis on $\SO$. 
In short, the proposed attitude control system in the presence of inequality constraints is computationally efficient and able to handle uncertain disturbances. 
The effectiveness of this approach is illustrated via numerical simulation and experimental results.% on a hexrotor aerial vehicle.


\section{Problem Formulation}\label{sec:prob_form}
\subsection{Attitude Dynamics}\label{sec:att_dyn}
Consider the attitude dynamics of a rigid body. 
We define an inertial reference frame and a body frame whose origin is at the center of mass and aligned with the principle directions of the body. 
The configuration manifold of the attitude dynamics is the special orthogonal group: \(\SO = \{R\in\R^{3\times 3}\,|\, R^TR=I,\;\mathrm{det}[R]=1\} \).
The rotation matrix $R\in\SO$ represents the transformation of the representation of a vector from the body-fixed frame to the inertial reference frame. 
The equations of motion are given by
\begin{gather}
	J\dot\Omega + \Omega\times J\Omega = u+W(R,\Omega)\Delta ,\label{eqn:Wdot}\\
	\dot R = R\hat\Omega ,\label{eqn:Rdot}
\end{gather}
where $J\in\R^{3\times 3}$ is the inertia matrix, and $\Omega\in\R^{3}$ is the angular velocity represented with respect to the body-fixed frame. 
The control moment is denoted by $u\in\R^{3}$, and it is expressed with respect to the body-fixed frame. 
We assume that the external disturbance is expressed by $W(R,\Omega)\Delta$, where $W(R,\Omega):\SO\times\R^{3}\rightarrow \R^{3\times p}$ is a known function of the attitude and the angular velocity.
The disturbance is represented by $\Delta\in\R^{p}$ and is an unknown, but fixed uncertain parameter.
In addition, we assume that a bound on \( W(R, \Omega) \text{ and } \Delta \) is known and given by
\begin{equation}
	\norm{W} \leq B_W , \quad \norm{\Delta} \leq B_\Delta \,. \label{eqn:W_bound}
\end{equation}
This form of uncertainty enters the system dynamics through the input channel and is referred to as a matched uncertainty. 
Many physically realizable disturbances may be modeled in this manner such as a gravity gradient torque.

\subsection{State Inequality Constraint}
The two-sphere is the manifold of unit-vectors in \( \R^3 \) such that \( \Sph^2 = \{ q \in \R^3 \,  \vert \, \norm{q} = 1 \}\).
We define \( r \in \Sph^2 \) to be a unit vector from the mass center of the rigid body along a certain direction and it is represented with respect to the body-fixed frame.
For example, \( r \) may represent the pointing direction of an on-board optical sensor.
We define \( v \in \Sph^2 \) to be a unit vector from the mass center of the rigid body toward an undesired pointing direction and represented in the inertial reference frame.
For example, \( v \) may represent the inertial direction of a bright celestial object or the incoming direction of particles or other debris.
It is further assumed that optical sensor has a strict non-exposure constraint with respect to the celestial object.
We formulate this hard constraint as
\begin{align}
	r^T R^T v \leq \cos \theta , \label{eqn:constraint}
\end{align}
where we assume \( \ang{0} \leq \theta \leq \ang{90}  \) is the required minimum angular separation between \( r \) and \( R^T v \). 

The objective is to a determine a control input \( u \) that stabilizes the system from an initial attitude \( R_0 \) to a desired attitude \( R_d \) while ensuring that~\cref{eqn:constraint} is always satisfied.

\section{Attitude Control on $\SO$ with Inequality Constraints}

The first step in designing a control system on a nonlinear manifold \( \Q \) is the selection of a proper configuration error function. 
This configuration error function, \( \Psi : \Q \times \Q \to \R \), is a smooth and proper positive definite function that measures the error between the current configuration and a desired configuration. 
Once an appropriate configuration error function is chosen, one can then define a configuration error vector and a velocity error vector in the tangent space \( \mathsf{T}_q \Q \) through the derivatives of \( \Psi \)~\cite{bullo2004}. 
With the configuration error function and vectors the remaining procedure is analogous to nonlinear control design on Euclidean vector spaces. 
One chooses control inputs as functions of the state through a Lyapunov analysis on \Q.

To handle the attitude inequality constraint, we propose a new attitude configuration error function. 
More explicitly, we extend the trace form used in~\cite{bullo2004,LeeITCST13} for attitude control on \(\SO\) with the addition of a logarithmic barrier function. 
Based on the proposed configuration error function,  nonlinear geometric attitude controllers are constructed. 
A smooth control system is first developed assuming that there is  no disturbance, and then it is extended to include an adaptive update law for stabilization in the presence of unknown disturbances. 

\begin{prop}[Attitude Error Function] \label{prop:config_error}
%We assume a desired attitude command \( ( R_d, \Omega_d = 0 ) \), the current attitude and angular velocity \( ( R, \Omega) \), and a state constraint~\cref{eqn:constraint} are given.
Define an attitude error function \( \Psi : \SO \to \R \), an attitude error vector \( e_R \in \R^3 \), and an angular velocity error vector \( e_\Omega \in \R^3 \) as follows:
\begin{gather}
	\Psi(R) = A(R) B(R) , \label{eqn:psi} \\
	e_R = e_{R_A} B(R) + A(R) e_{R_B} , \label{eqn:eR} \\
	e_\Omega = \Omega , \label{eqn:eW}
\end{gather}
with
\begin{gather}
	A(R) = \frac{1}{2} \tr{G \left( I - R_d^T R\right)} , \label{eqn:A} \\
	B(R) = 1 - \frac{1}{\alpha} \ln \left( \frac{\cos \theta -  r^T R^T v}{1 + \cos \theta}\right) . \label{eqn:B} \\
	e_{R_A} = \frac{1}{2} \parenth{G R_d^T R - R^T R_d G} ^ \vee , \label{eqn:eRA} \\
	e_{R_B} = \frac{ \left( R^T v\right)^\vee r}{\alpha \left(r^T R^T v - \cos \theta \right)} . \label{eqn:eRB} 
\end{gather}	
where \( \alpha \in \R \) is defined as a positive constant and the matrix \( G \in \R^{3 \times 3} \) is defined as a diagonal matrix matrix for distinct, positive constants \( g_1, g_2, g_3 \in \R \).
Then, the following properties hold
\begin{enumerate}[(i)]
	\item \label{item:prop_psi_psd} \(\Psi\) is positive definite about \( R = R_d\)
	\item \label{item:prop_era}The variation of \( A(R) \) with respect to a variation of \( \delta R = R \hat{\eta} \) for \( \eta \in \R^3 \) is given by
	\begin{align}
		\dirDiff{A}{R} &= \eta \cdot e_{R_A} .
	\end{align}
	\item \label{item:prop_erb} The variation of \( B(R) \) with respect to a variation of \( \delta R = R \hat{\eta} \) for \( \eta \in \R^3 \) is given by
	\begin{align}
		\dirDiff{B}{R} &= \eta \cdot e_{R_{B}} .
	\end{align}
	\item \label{item:prop_crit}The critical points of \( \Psi \) are $R_d$, and $R_d \exp(\pi \hat{s})$ for $s \in \braces{e_1, e_2, e_3}$ satisfying $R^T v = \pm r$.
	\item \label{item:prop_era_upbound}An upper bound of \( \norm{e_{R_A}} \) is given as:
	\begin{align}
		\norm{e_{R_A}}^2 \leq \frac{A(R)}{b_1} , \label{eqn:psi_lower_bound}
	\end{align}
	where the constant \( b_1 \) is given by \( b_1 = \frac{h_1}{h_2 + h_3} \) for 
	\begin{align*}
		h_1 &= \min\braces{g_1 + g_2, g_2 + g_3 , g_3 + g_1} ,\\
		h_2 &= \min\braces{\parenth{g_1 -g_2}^2,\parenth{g_2 -g_3}^2 , \parenth{g_3 -g_1}^2} ,\\
		h_3 &= \min\braces{\parenth{g_1 + g_2}^2, \parenth{g_2 + g_3}^2 , \parenth{g_3 + g_1}^2}.		
	\end{align*}
\end{enumerate}
\end{prop}
\begin{proof}
For brevity, the proof is relegated to~\cite{kulumani2016b}.
\end{proof}

\Cref{eqn:psi} is composed of an attractive term, \( A (R) \) toward the desired attitude, and a repulsive term, \( B(R) \) away from the undesired direction \( R^T v \).
In order to visualize the attitude error function on \( \SO \) we utilize a spherical coordinate representation.
We parametrize the rotation matrix \( R \in \SO \) in terms of the spherical angles \( \SI{-180}{\degree} \leq \lambda \leq \SI{180}{\degree}  \) and \( \SI{-90}{\degree} \leq \beta \leq \SI{90}{\degree} \). 
Using the elementary Euler rotations the rotation matrix is defined as \( R = \exp( \lambda \hat{e}_2) \exp( \beta \hat{e}_3) \).
We iterate over the domains of \( \lambda\) and \(\beta\) in order to rotate the body-fixed vector \( r \) throughout the two-sphere \( \S^2 \) as shown in~\cref{fig:config_error}.
\( A(R)\) is illustrated in~\cref{fig:attract_error}, where the desired attitude lies at the minimum \(\lambda=\beta=\SI{0}{\degree}\).

To incorporate the state inequality constraints we apply a logarithmic barrier term.
A visualization of the barrier function is presented in~\cref{fig:avoid_error} which shows that as the boundary of the constraint is neared, or \( r^T R^T v \to \cos \theta \), the barrier term increases, \( B \to \infty\).
We use the scale factor~\(\frac{1}{1+\cos \theta} \) to ensure that \( \Psi \) remains positive definite.
The logarithmic function is popular as it quickly decays away from the constraint boundary.
The positive constant \( \alpha \) serves to shape the barrier function.
As \( \alpha \) is increased the impact of \( B(R) \) is reduced away from the constraint boundary. 
The superposition of the attractive and repulsive functions is shown in~\cref{fig:combined_error}.
The control system allows the attitude trajectory follows the negative gradient of \( \Psi \) toward the minimum at \( R = R_d \), while avoiding the constraints.
\begin{figure} 
	\centering 
	\begin{subfigure}[htbp]{0.45\columnwidth} 
		\includegraphics[width=\columnwidth]{attract_error} 
		\caption{Attractive \( A(R) \) } \label{fig:attract_error} 
	\end{subfigure}~ %add desired spacing between images, e. g. ~, \quad, \qquad, \hfill etc. %(or a blank line to force the subfigure onto a new line) 
	\begin{subfigure}[htbp]{0.45\columnwidth} 
		\includegraphics[width=\columnwidth]{avoid_error} 
		\caption{Repulsive \( B(R) \)} \label{fig:avoid_error} 
	\end{subfigure}
	\centering
	\begin{subfigure}[htbp]{0.45\columnwidth} 
		\includegraphics[width=\columnwidth]{combined_error} 
		\caption{Configuration \( \Psi \)} \label{fig:combined_error} 
	\end{subfigure}
	\caption{Configuration error function visualization}
	\label{fig:config_error} 
\end{figure}

While~\cref{eqn:B} represents a single inequality constraint given as~\cref{eqn:constraint}, it is readily generalized to multiple constraints of an arbitrary form. 
For example, the configuration error function can be formulated as $\Psi=A[1+\sum_i C_i]$, where $C_i$ has the form of $C_i=B-1$ for the $i$-th constraint. 
In this manner, one may enforce multiple state inequality constraints, and we later demonstrate this through numerical simulation. 

\begin{prop}[Error Dynamics]\label{prop:error_dyn}
	The attitude error dynamics for \( \Psi, e_R, e_\Omega \) satisfy 
	\begin{gather}
		\diff{}{t} \parenth{\Psi} = e_R \cdot e_\Omega , \label{eqn:psi_dot}\\
		%\diff{}{t} \parenth{e_R} = \dot{e}_{R_A} B + e_{R_A} \dot{B} + \dot{A}e_{R_B} + A \dot{e}_{R_B} , \label{eqn:eR_dot}\\
		\diff{}{t} \parenth{e_{R_A}} = E(R, R_d) e_\Omega , \label{eqn:eRA_dot} \\
		\diff{}{t} \parenth{e_{R_B}} = F(R) e_\Omega , \label{eqn:eRB_dot} \\
		\diff{}{t} \parenth{A(R)} = e_{R_A} \cdot e_\Omega , \label{eqn:A_dot} \\
		\diff{}{t} \parenth{B(R)} = e_{R_B} \cdot e_\Omega , \label{eqn:B_dot} \\
		\diff{}{t} \parenth{e_\Omega} = J^{-1} \parenth{-\Omega \times J \Omega + u + W(R, \Omega) \Delta} , \label{eqn:eW_dot}
	\end{gather}
	where the matrices \(E(R,R_d), F(R) \in \R^{3\times3} \) are given by
	\begin{gather}
		E(R,R_d) = \frac{1}{2} \parenth{\tr{R^T R_d G}I - R^T R_d G} , \label{eqn:E} \\
		F(R) = \frac{1}{\alpha \parenth{r^T R^T v - \cos \theta}} \left[\parenth{v^T R r} I - R^T v r^T + \right. \nonumber \\
		\left. \frac{R^T \hat{v} R r v^T R \hat{r}}{\parenth{r^T R^T v - \cos \theta}}\right] . \label{eqn:F}
	\end{gather}
\end{prop}
\begin{proof}
For brevity, the proof is relegated to~\cite{kulumani2016b}.
\end{proof}

\subsection{Attitude Control without Disturbance}
We introduce a nonlinear geometric controller for the attitude stabilization of a rigid body.
We first assume that there is no disturbance, i.e., \( \Delta = 0 \).
\begin{prop}[Attitude Control]\label{prop:att_control}
	Given a desired attitude command \( \parenth{R_d, \Omega_d = 0} \), which satisfies the constraint~\cref{eqn:constraint}, and positive constants \( k_R, k_\Omega \in \R \) we define a control input \( u \in \R^3 \) as follows
	\begin{gather}
		u = -k_R e_R - k_\Omega e_\Omega + \Omega \times J \Omega . \label{eqn:nodist_control}
	\end{gather}
	Then the zero equilibrium of the attitude error is asymptotically stable, and the inequality constraint is satisfied.
\end{prop}
\begin{proof}
For brevity, the proof is relegated to~\cite{kulumani2016b}.
\end{proof}

This proposition only guarantees that the attitude error vector \( e_R \) asymptotically converges to zero.
However, this does not necessarily imply that \( R \to R_d \) as \( t \to \infty \), since there are at most three additional critical points of \( \Psi \) where \( e_R = 0 \) and \( R^T v = \pm r \).
At an undesired equilibrium \( R = \exp{ \parenth{\pi \hat{e}_i}} R_d \) and \( e_\Omega =0 \).
However, we can show that these undesired equilibrium points are unstable in the sense of Lyapunov~\cite{LeeITCST13}.
As a result, we can claim that the desired equilibrium \( R = R_d \text{ and } e_\Omega = 0 \) is almost globally asymptotically stable, which means that the set of initial conditions that do not converge to the desired attitude has zero Lebesgue measure.
 
%This results in \( A \) having a value of \( g_1 + g_2, g_2 + g_3 \) or \( g_3 + g_1 \).
%At any of these undesired equilibria we have \( V = k \). 
%We define an augmented Lyapunov function as
%\begin{align*}
%	W = k - V = \frac{1}{2} e_\Omega \cdot J e_\Omega + k_R \parenth{\frac{k}{k_R}+ \Psi(R,R_d)} .
%\end{align*}
%We can choose an attitude \( R \) arbitrarily close to the equilibrium point \( \exp{ \parenth{\pi \hat{e}_i}} R_d \) such that the \( k_R \parenth{\frac{k}{k_R}+\Psi }> 0 \).
%This is due to the fact that \( \Psi \) is positive definite about \( R = R_d \) as shown in~\cref{item:prop_psi_psd}.
%If \( e_\Omega \) is sufficiently small this results in \( W > 0 \) and \( \dot{W} = -\dot{V} > 0\) from~\cref{eqn:vdot_nodist}.
%According to Chateav's theorem, the undesired equilibria are unstable~\cite{khalil1996}.
\subsection{Adaptive Control}
We extend the results of the previous section with the addition of a fixed but unknown disturbance \( \Delta \).
This scenario is typical of many mechanical systems and represents unmodeled dynamics or external moments acting on the system.
For example, Earth orbiting spacecraft typically experience a torque due to a gravitational gradient.
% as well as external torques to due solar radiation pressure.
Aerial vehicles will similarly experience external torques due to air currents or turbulence.
An adaptive control system is introduced to asymptotically stabilize the system to a desired attitude while ensuring that state constraints are satisfied. %We first show several properties of the controlled system. 


\begin{prop}[Bound on \( \dot{e}_R \)]\label{prop:eR_dot_bound}
Consider a domain \( D \) about the desired attitude defined as
\begin{align}
	D = \braces{R \in \SO \vert \Psi < \psi < h_1, r^T R^T v < \beta < \cos \theta}. \label{eqn:domain}
\end{align}
Then the following statements hold:
\begin{enumerate}[(i)]
	\item \label{item:prop_eR_dot_bound_AB} Upper bounds of \( A(R) \) and \( B(R) \) are given by
	\begin{gather}
		\norm{A} < c_A  , \quad \norm{B} < c_B . \label{eqn:AB_bound}
	\end{gather}
	\item \label{item:prop_eR_dot_bound_EF} Upper bounds of \( E(R,R_d) \) and \( F(R) \) are given by
	\begin{gather}
		\norm{E} \leq \frac{1}{\sqrt{2}} \tr{G}  , \label{eqn:E_bound} \\
		\norm{F} \leq \frac{\parenth{\beta^2 + 1}\parenth{\beta - \cos \theta}^2 + 1 + \beta^4-2 \beta^2}{\alpha^2 \parenth{\beta-\cos \theta}^4} . \label{eqn:F_bound}
	\end{gather}
	\item Upper bounds of the attitude error vectors \( e_{R_A} \) and \( e_{R_B} \) are given by
	\begin{gather}
		\norm{e_{R_A}} \leq \sqrt{\frac{\psi}{b_1}}, \label{eqn:eRA_bound} \\
		\norm{e_{R_B}} \leq \frac{\sin\theta}{\alpha \parenth{\cos \theta - \beta}}. \label{eqn:eRB_bound}
	\end{gather}
\end{enumerate}
These results are combined to yield a maximum upper bound of the time derivative of the attitude error vector \( \dot{e}_R \) as
\begin{gather}
	\norm{\dot{e}_R} \leq H \norm{e_\Omega} ,\label{eqn:eR_bound}
\end{gather}
where  \( H \in \R \) is defined as
\begin{gather}
	H = \norm{B} \norm{E} + 2 \norm{e_{R_A}} \norm{e_{R_B}} + \norm{A}\norm{F}. \label{eqn:H}
\end{gather}
\end{prop}

\begin{proof}
For brevity, the proof is relegated to~\cite{kulumani2016b}.
\end{proof}
\begin{prop}[Adaptive Attitude Control]\label{prop:adaptive_control}
Given  a desired attitude command \( (R_d, \Omega_d = 0 )\) and positive constants \( k_R, k_\Omega, k_\Delta, c \in \R \), we define a control input \( u \in \R^3\) and an adaptive update law for the estimated uncertainty \( \bar{\Delta} \) as follows:
\begin{align}
	u &= - k_R e_R - k_\Omega e_\Omega + \Omega \times J \Omega - W \bar{\Delta} , \label{eqn:adaptive_control} \\
	\dot{\bar{\Delta}} &= k_\Delta W^T \parenth{e_\Omega + c e_R} . \label{eqn:delta_dot}
\end{align}
If \( c \) is chosen such that
\begin{gather}
	0 < c < \frac{4 k_R k_\Omega}{k_\Omega^2 + 4 k-R \lambda_M H} , \label{eqn:c_bound}
\end{gather}
  the zero equilibrium of the error vectors is stable in the sense of Lyapunov. Furthermore, $e_R,e_\Omega\rightarrow 0$ as $t\rightarrow\infty$, and $\bar\Delta$ is uniformly bounded.
\end{prop}
\begin{proof}
For brevity, the proof is relegated to~\cite{kulumani2016b}.
\end{proof}

Nonlinear adaptive controllers have been developed for attitude stabilization in terms of modified Rodriguez parameters and quaternions, as well as attitude tracking in terms of Euler angles. 
The proposed control system is developed on \(\SO\) and avoids the issues inherent in attitude representations, while incorporating state inequality constraints. 
In addition, the control system handles uncertain disturbances.

Compared to the previous work on constrained attitude control, we present a geometrically exact control system without parameterizations.
In addition, we incorporate state inequality constraints on \( \SO \).
The presented control system is computed in real-time and offers significant computational advantages over previous iterative methods. 
In addition, the riguous mathematical proof guarantees stability.
\section{Numerical Examples}
We demonstrate the performance of the proposed control system via numerical simulation.
The inertia tensor of a rigid body is given as
\begin{gather*}
	J = \begin{bmatrix}
	\num{5.57e-3} & \num{6.17e-5} & \num{-2.50e-5} \\
	\num{6.17e-5} & \num{5.57e-3} & \num{1.00e-5} \\
	\num{-2.50e-5} & \num{1.00e-5} & \num{1.05e-2}
	\end{bmatrix} \si{\kilo\gram\meter\squared} .
\end{gather*} 
The control system parameters are chosen as
\begin{gather*}
	G = \text{diag} [0.9,1.1,1.0], \quad k_R = 0.4 , \quad	k_\Omega = 0.296 ,\\
	c = 1.0 , \quad k_\Delta = 0.5 , \quad \alpha = 15 .
\end{gather*}
A body fixed sensor is defined as \(r = [1,0,0]\), while multiple inequality constraints are defined in~\Cref{tab:constraints}.
The simulation parameters are chosen to be similar to those found in~\cite{lee2011b}, however we increase the size of the constraint regions to create a more challenging scenario for the control system.

The initial state is defined as \(R_0 =  \exp(\ang{225} \times \frac{\pi}{180} \hat{e}_3), \Omega_0 = 0\). 
The desired state is \( R_d = I,\Omega_d = 0\).
\begin{table}[htbp]
\caption{Constraint Parameters~\label{tab:constraints}}
\begin{center}\begin{tabular}{lc}
Constraint Vector (\( v \)) & Angle (\( \theta \)) \\ \hline \hline 
\([0.174,\,-0.934,\, -0.034]^T\) & \ang{40} \\ \hline 
\([0 ,\, 0.7071 ,\, 0.7071]^T\) & \ang{40} \\ \hline 
\([-0.853 ,\, 0.436 ,\, -0.286]^T\) & \ang{40} \\ \hline 
\([-0.122 ,\,-0.140,\, -0.983]^T\) & \ang{20}\end{tabular} 
\end{center}
\end{table}
We show simulation results for the system stabilizing about the desired attitude with and without the adaptive update law from~\Cref{prop:adaptive_control}.
We assume a fixed disturbance of \(\Delta = \begin{bmatrix} 0.2 & 0.2 & 0.2 \end{bmatrix}^T \), with the function \( W(R,\Omega) = I \).
This form is equivalent to an integral control term which penalizes deviations from the desired configuration.
The first term of~\cref{eqn:delta_dot} has the effect of increasing the proportional gain of the control system, since the time derivative of the attitude error vector, \( \dot{e}_{R} \), is linear with respect to the angular velocity error vector \( e_\Omega\).
\begin{figure} 
	\centering 
	\begin{subfigure}[htbp]{0.5\columnwidth} 
		\includegraphics[width=\columnwidth]{eR_con} 
		\caption{Attitude error vector \(e_R\) } \label{fig:eR_con} 
	\end{subfigure}~ %add desired spacing between images, e. g. ~, \quad, \qquad, \hfill etc. %(or a blank line to force the subfigure onto a new line) 
	\begin{subfigure}[htbp]{0.5\columnwidth} 
		\includegraphics[width=\columnwidth]{Psi_con} 
		\caption{Configuration error \( \Psi \)} \label{fig:Psi_con} 
	\end{subfigure}
	\caption{Attitude stabilization without adaptive update law}
	\label{fig:con} 
\end{figure}
\begin{figure} 
	\centering 
	\begin{subfigure}[htbp]{0.5\columnwidth} 
		\includegraphics[width=\columnwidth]{Psi_adapt} 
		\caption{Configuration error \( \Psi \)} \label{fig:Psi_adapt} 
	\end{subfigure}~
	\begin{subfigure}[htbp]{0.5\columnwidth} 
		\includegraphics[width=\columnwidth]{constraint_angles} 
		\caption{Angle to constraints} \label{fig:con_angles} 
	\end{subfigure}
	
	\centering
	\begin{subfigure}[htbp]{0.5\columnwidth} 
		\includegraphics[width=\columnwidth]{delta_adapt} 
		\caption{Disturbance estimate \( \bar \Delta \)} \label{fig:delta_adapt} 
	\end{subfigure}~
	\begin{subfigure}[htbp]{0.5\columnwidth} 
		\includegraphics[trim=9cm 2.5cm 0 0,clip,width=1.29\columnwidth]{cad_adapt} 
		\caption{Attitude trajectory} \label{fig:cad_adapt} 
	\end{subfigure}
	\caption{Attitude stabilization with adaptive update law}
	\label{fig:adapt} 
\end{figure}

Simulation results without the adaptive update law are shown in~\cref{fig:con}.
Without the update law,~\cref{fig:Psi_con} shows that the configuration error function does not converge to zero and there exist steady state errors.
\Cref{fig:adapt} shows that the addition of the adaptive update law the system converges to the desired attitude.
The path of the body fixed sensor in the inertial frame, namely \( R r \), is illustrated in~\cref{fig:cad_adapt}.
The initial attitude is represented with the green circle while the final attitude is marked with a green \(\times\).
The inequality constraints from~\Cref{tab:constraints} are depicted as red cones, where the cone half angle is \( \theta \).
The control system is able to asymptotically converge to zero attitude error while avoiding the constrained regions.
\Cref{fig:con_angles} shows that the angle \( \arccos(r^T R^T v_i) \) to each constraint in~\Cref{tab:constraints} is satisfied for the entire maneuver.
In addition, the estimate of the disturbance converges to the the true value.

Both control system are able to automatically avoid the constrained regions. 
In addition, these results show that it is straightforward to incorporate an arbitrary amount of large constraints.
In spite of this challenging configuration space the proposed control system offers a simple method of avoiding constrained regions.
These closed-loop feedback results are computed in real time and offer a significant advantage over typical open-loop planning methods.
These results show that the proposed geometric adaptive approach is critical to attitude stabilization in the presence of state constraints and disturbances.
\section{Experiment on Hexrotor UAV}
A hexrotor unmanned aerial vehicle (UAV) has been developed at the Flight Dynamics and Controls Laboratory (FDCL) at the George Washington University~\cite{kaufman2014}.
The UAV is composed of three pairs of counter-rotating propellers. 
%Typical quadrotor UAVs are composed of four or more co-planar propellers.
%As a result, these systems are underactuated and unable to impart a force along every degree of freedom.
%For example, quadrotor UAVs are unable to translate laterally without first conducting a rotation.
%Conversely, the propeller pairs of the hexrotor are angled relative to one another to allow for a fully actuated rigid body.
The propeller pairs of the hexrotor are angled relative to one another to allow for a fully actuated rigid body.
%This allows the hexrotor to impart a force in any direction and a moment about any axis. 

The hexrotor UAV, shown in~\cref{fig:hexrotor}, is composed of the following hardware:
\begin{itemize}
	\item Onboard ODROID XU3 computer module.
	\item VectorNav VN100 IMU operating via TTL serial %at over \SI{100}{\hertz} 
	\item BLDC motors with BL-Ctrl-2.0 ESC via I2C.
	\item Vicon motion capture system.
\end{itemize}
In order to constrain the motion and test only the attitude dynamics we attach the hexrotor to a spherical joint.
The center of rotation is below the center of gravity of the hexrotor.
As a result, there is a destabilizing gravitational moment and the resulting attitude dynamics are similar to an inverted pendulum model.
We augment the control input in~\cref{eqn:adaptive_control} with an additional term to negate the effect of the gravitational moment.

\begin{figure}
	\centering
	\includegraphics[width = 0.7\columnwidth]{hexrotor}
	\caption{Attitude control testbed~\label{fig:hexrotor}}
\end{figure}

A sensor pointing direction is defined in the body frame of the hexrotor as \( r = [1,0,0]^T \).
We define an obstacle in the inertial frame as \( v = [\frac{1}{\sqrt{2}}, \frac{1}{\sqrt{2}}, 0]^T \) with \( \theta = \ang{12} \).
An initial state is defined as \(R(0) = \exp( \frac{\pi}{2} \hat{e}_3) \), while the desired state is \(R_d =I \).
This results in the UAV performing a \ang{90} yaw rotation about the vertical axis of the spherical joint and the constrained region is on the shortest path connecting $R_0$ and $R_d$. 
The attitude control system is identical to the one presented in~\Cref{prop:adaptive_control} with the exception of a gravity moment term and the following parameters: \(k_R = 0.4, k_\Omega = 0.7 ,c = 0.1 , \alpha = 8 \text{ and } k_\Delta = 0.05\).
\begin{figure} 
	\centering 
	\begin{subfigure}[htbp]{0.5\columnwidth} 
		\includegraphics[width=\columnwidth]{eR_exp} 
		\caption{Attitude error vector \(e_R\) } \label{fig:eR_exp} 
	\end{subfigure}~ %add desired spacing between images, e. g. ~, \quad, \qquad, \hfill etc. %(or a blank line to force the subfigure onto a new line) 
	\begin{subfigure}[htbp]{0.5\columnwidth} 
		\includegraphics[width=\columnwidth]{Psi_exp} 
		\caption{Configuration error \( \Psi \)} \label{fig:Psi_exp} 
	\end{subfigure}
	
	\begin{subfigure}[htbp]{0.5\columnwidth} 
		\includegraphics[width=\columnwidth]{u_exp} 
		\caption{Control input \( u\)} \label{fig:u_exp} 
	\end{subfigure}~
	\begin{subfigure}[htbp]{0.5\columnwidth} 
		\includegraphics[width=\columnwidth]{traj_exp} 
		\caption{Attitude Trajectory} \label{fig:traj_exp} 
	\end{subfigure}
	\caption{Constrained Attitude stabilization experiment}
	\label{fig:exp} 
\end{figure}

The experimental results are shown in~\Cref{fig:exp}.
In order to maneuver the system ``close" to the constrained zone we utilize several intermediary set points on either side of the obstacle.
From the initial attitude the hexrotor rotates to the first set point, pauses, and then continues around the obstacle to the second set point before continuing toward the desired attitude.
As a result this creates the stepped behavior of the configuration error history as shown in~\cref{fig:Psi_exp}.

The brushless motors of the hexrotor allow for large control inputs which are critical to enable aggressive maneuvers. 
When constrained to the spherical joint the hexrotor is capable of performing responsive attitude changes with high angular velocities.
In addition, the on-board control and motion capture system operate at a discrete interval of approximately \SI{100}{\hertz}.
It is possible for the system to violate the constraint between these discrete steps and cause numerical instability.
We choose conservative control gains to  allow sufficient time for the measurement and control software to function correctly.

There exist several sources of error in the experimental setup.
The motion capture system uses a series of optical sensors to determine the relative position of several tracking markers. 
These markers as well as the cameras must remain fixed to ensure accurate attitude measurement.
In addition, the spherical joint is not fixed at the center of mass but is instead offset due to the physical structure of the hexrotor.
As a result a disturbance moment is induced on the system.

This results in a small steady state error in the vicinity of the desired attitude. 
Over time~\cref{eqn:delta_dot} will remain non-zero while \( e_R \neq 0 \).
This will cause an increase in control input until the steady-state error is reduced. 
Further tuning of the control gains would enable a reduced settling time.

The hexrotor avoids the constrained region illustrated by the circular cone in~\cref{fig:traj_exp}, by rotating around the boundary of the constraint. 
This verifies that the proposed control system exhibits the desired performance in the experimental setting as well. 
A video clip showing the attitude maneuver is available \url{https://youtu.be/dsmAbwQram4}.
\section{Conclusions}\label{sec:conclusions}
We have developed a geometric adaptive control system which incorporates state inequality constraints on \(\SO\).
The presented control system is developed directly on \(\SO\) and it avoids singularities and ambiguities that are inherent to attitude parameterizations.
The attitude configuration error is augmented with a barrier function to avoid the constrained region, and an adaptive control law is proposed to cancel the effects of uncertainties. 
We show the stability of the  proposed control system through a rigorous mathematical analysis.
In addition, we have demonstrated the control system via numerical simulation and hardware experiments on a hexrotor UAV.
A novel feature of this control is that it is computed autonomously on-board the UAV.
This is in contrast to many state constrained attitude control systems which require an a priori attitude trajectory to be calculated. 
The presented method is simple, efficient and ideal for hardware implementation on embedded systems.



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\addtolength{\textheight}{-12cm}   
                                  
\bibliography{BibMaster,library}
\bibliographystyle{IEEEtran}

\end{document}
