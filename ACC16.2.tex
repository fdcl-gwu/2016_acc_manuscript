%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%2345678901234567890123456789012345678901234567890123456789012345678901234567890
%        1         2         3         4         5         6         7         8

\documentclass[letterpaper, 10 pt, conference]{ieeeconf}  % Comment this line out if you need a4paper
%\documentclass[a4paper, 10pt, conference]{ieeeconf}      % Use this line for a4 paper
\IEEEoverridecommandlockouts                              % This command is only needed if 
                                                          % you want to use the \thanks command
\overrideIEEEmargins                                      % Needed to meet printer requirements.

% See the \addtolength command later in the file to balance the column lengths
% on the last page of the document

\usepackage{ieee_packages}

\newcommand{\EditTL}[1]{{\color{red}\protect #1}}
%\renewcommand{\EditTL}[1]{{\protect #1}}

\newtheorem{definition}{Definition}
\newtheorem{lem}{Lemma}
\newtheorem{prop}{Proposition}
\newtheorem{cor}{Corollary}
\newtheorem{remark}{Remark}

\title{\LARGE \bf
Geometric Adaptive Control of Attitude Dynamics on $\SO$\\ with State Inequality Constraints}

\author{Shankar Kulumani, Chris Poole, and Taeyoung Lee
\thanks{Shankar Kulumani, Chris Poole, Taeyoung Lee, Mechanical and Aerospace Engineering, George Washington University, Washington DC 20052 {\tt \{skulumani,poolec,tylee\}@gwu.edu}}
\thanks{This research has been supported in part by NSF under the grants CMMI-1243000, CMMI-1335008, and CNS-1337722.}
}

\begin{document}

\maketitle
\thispagestyle{empty}
\pagestyle{empty}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{abstract}
We present a new geometric adaptive control system with state inequality constraints for the attitude dynamics of a rigid body.
We globally express the attitude dynamics and control system using the special orthogonal group. 
This representation is geometrically exact and avoids singularities and ambiguities of other attitude parameterizations, such as Euler angles and quaternions.
Attitude constraints are incorporated and automatically considered by the control system.
In addition, we develop an adaptive update law that enables attitude stabilization in the presence of unknown disturbances. 
We demonstrate the effectiveness of the control system through numerical simulation and experimental results on a hexrotor UAV.

\end{abstract}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Introduction}\label{sec:intro}
Many researchers have focused on the study of the attitude dynamics of a rigid body~\cite{hughes2004,wertz1978}.
Rigid body attitude control is an important problem for aerospace vehicles, ground and underwater vehicles, as well as robotic systems.
One distinctive feature of the attitude dynamics of rigid bodies is that it evolves on a nonlinear manifold.
The three-dimensional special orthogonal group is the set of \( 3 \times 3 \) orthogonal matrices whose determinant is one.
This configuration space is not Euclidean and yields unique stability properties which are not observable on a linear space.
For example, it is impossible to achieve global attitude stabilization using continuous time-invariant feedback~\cite{bhat2000}.
Attitude control is typically studied using a variety of attitude parameterizations, such as Euler angles or quaternions~\cite{shuster1993}.

% topological obstruction - smooth control system can only achieve almost global asymptotic stability

% discuss issues with parameterizations
All attitude parameterizations fail to represent the nonlinear configuration space both globally and uniquely~\cite{chaturvedi2011a}.
For example, minimal attitude representations, such as Euler angle sequences or modified Rodriguez parameters, suffer from singularities.
These attitude representations are not suitable for large angular slews.
In order to avoid singularities, the designer must carefully switch the chosen Euler angle sequence based on the operating region.
Another option is to artificially limit the operating region of the rigid body.
This ensures the system operates in a region free from singularities but limits the performance capabilities and ability to perform arbitrarily large angular maneuvers.
Quaternions do not have singularities but they double cover the special orthogonal group.
As a result, any physical attitude is represented by a pair of antipodal quaternions on the three-sphere.
An immediate implication of this ambiguity is that closed-loop stability properties derived using quaternions may not hold for the physical rigid body evolving on the special orthogonal group.
During implementation, the design must carefully resolve this non-unique representation in quaternion based attitude control system to avoid undesirable unwinding behavior~\cite{bhat2000}.
For certain initial conditions, where the rigid body starts closed to the desired attitude, the system unnecessarily rotates through a large angle even while the initial error is small.

% introduce concept of state inequality constraints and how it creates a nonconvex region 
% mention applicability of this for spacecraft maneuvers, spherical air bearing testing, hardware limitations
Many physical rigid body systems must perform large angular slews in the presence of state constraints.
For example, autonomous spacecraft or aerial systems are typically equipped with sensitive optical payloads, such as infrared or interferometric sensors.
These systems require retargeting while avoiding direct exposure to sunlight or other bright objects.
Determining a satisfactory attitude control maneuver in the presence of state constraints is a challenging task.
The removal of constrained regions from the rotational configuration space results in a \textit{nonconvex} region.
The attitude control problem in the absence of constraints has been extensively studied~\cite{sanyal2008,lee2010,lee2011a}.
However, the attitude control problem in the presence of constraints has received much less attention.

% discuss how previous papers (mcinnes and lee/meshabi) have short comings
Several approaches have been developed to treat the attitude control problem in the presence of constraints.
A geometric approach is used in~\cite{hablani1999} to determine feasible attitude trajectories prior to implementation.
Typically, an optimal or easily implementable on-board control scheme for attitude maneuvers is considered without state constraints.
The algorithm then seeks an intermediate point such that the control scheme can be applied for each segment without violation of the constraints.
While the geometric method is conceptually simple it is difficult to generalize for an arbitrary amount of constraints.
In addition, this geometric type of approach is only applicable to problems where the selection of intermediate points are computationally feasible

The approach in~\cite{frazzoli2001} involves the use of randomized motion planning algorithms to solve the constrained attitude control problem.
A graph is generated consisting of vertices from an initial attitude to a desired attitude. 
A random iterative search is conducted to determine a path through the graph such that a given cost functional is minimized.
Once an appropriate path is determined an appropriate control is implemented to perform the attitude maneuver.
The random search approach can only stochastically guarantee attitude convergence as it can be shown that as the number of vertices in the graph grow, the probability of non convergence goes to zero.
However, the computational demand grows as the size of the graph is increased. 
As a result, random search approaches are ill-suited to on-board implementation or in scenarios that require agile maneuvers.

In this work, we develop a geometric adaptive controller on \SO to reorient a rigid body in the presence of state inequality constraints.
We apply a potential function based approach developed directly on the nonlinear manifold \SO.
Geometric control is concerned with the development of control systems for dynamic systems that evolve on nonlinear manifolds.
Artificial potential functions have previously been applied to the attitude control problem~\cite{lee2011b,mcinnes1994}.
These approaches have used attitude parameterizations that give rise to singularities and ambiguities.
By characterizing the intrinsic geometric properties of \SO, we completely avoid issues associated with local parameterizations of the configuration manifold.
In this paper, we present a Lyapunov analysis to guarantee stability in the presence of state constraints.
In addition, we formulate an adaptive update law to enable attitude convergence in the presence of disturbances.
These results are demonstrated via numerical examples and experimental results on a robotic aerial vehicle.
\section{Problem Formulation}\label{sec:prob_form}
\subsection{Attitude Dynamics}\label{sec:att_dyn}
Consider the attitude dynamics of a rigid body. 
Define an inertial reference frame and a body-fixed frame. 
The configuration manifold of the attitude dynamics is the special orthogonal group:
\begin{align*}
	\SO = \{R\in\Re^{3\times 3}\,|\, R^TR=I,\;\mathrm{det}[R]=1\} \, ,
\end{align*}
where a rotation matrix $R\in\SO$ represents the transformation of the representation of a vector from the body-fixed frame to the inertial reference frame. 
The equations of motion are given by
\begin{gather}
	J\dot\Omega + \Omega\times J\Omega = u+W(R,\Omega)\Delta \, ,\label{eqn:Wdot}\\
	\dot R = R\hat\Omega \, ,\label{eqn:Rdot}
\end{gather}
where $J\in\Re^{3\times 3}$ is the inertia matrix, and $\Omega\in\Re^3$ is the angular velocity represented with respect to the body-fixed frame. 
The control moment is denoted by $u\in\Re^3$, and it is expressed with respect to the body-fixed frame. 
We assume that the external disturbance is expressed by $W(R,\Omega)\Delta$, where $W(R,\Omega):\SO\times\Re^3\rightarrow \Re^{3\times p}$ is a known function of the attitude and the angular velocity, and $\Delta\in\Re^p$ is an unknown, but fixed uncertain parameter.
In addition, we assume that a bound on \( W(R, \Omega) \) is known and given by
\begin{equation}
	\norm{W} \leq B_W \, . \label{eqn:W_bound}
\end{equation}

In~\refeqn{Rdot}, the \textit{hat} map $\wedge :\Re^{3}\rightarrow\so$ represents the transformation of a vector in $\Re^3$ to a $3\times 3$ skew-symmetric matrix such that $\hat x y = x\times y$ for any $x,y\in\Re^3$~\cite{BulLew05}. More explicitly, 
\begin{align*}
\hat x = \begin{bmatrix} 0 & -x_3 & x_2 \\ x_3 & 0 & -x_1 \\ -x_2 & x_1 & 0\end{bmatrix},
\end{align*}
for $x=[x_1,x_2,x_3]^T\in\Re^3$. 
The inverse of the hat map is denoted by the \textit{vee} map $\vee:\so\rightarrow\Re^3$. Several properties of the hat map are summarized as
\begin{gather}
%    \hat x y = x\times y = - y\times x = - \hat y x,\\
    x\cdot \hat y z = y\cdot \hat z x,\quad \hat x\hat y z = (x\cdot z) y - (x\cdot y ) z\label{eqn:STP},\\
%    \hat x\hat y z = (x\cdot z) y - (x\cdot y ) z,\label{eqn:VTP}\\
%    C^TC=-C^T\hat e_3^2 C = I_2
%    \hat x^T \hat x = (x^T x) I - x x^T,\\
%    \hat x \hat y \hat x=-(y^Tx)\hat x,\\
%    -\frac{1}{2}\tr{\hat x \hat y} = x^T y,\\
    \widehat{x\times y} = \hat x \hat y -\hat y \hat x = yx^T-xy^T,\label{eqn:hatxy}\\
    %\tr{\hat x A}=
    \tr{A\hat x }=\frac{1}{2}\tr{\hat x (A-A^T)}=-x^T (A-A^T)^\vee,\label{eqn:hat1}\\
%    \widehat{Ax} = \hat x \parenth{\frac{1}{2}\tr{A}I-A} + \parenth{\frac{1}{2}\tr{A}I-A}^T \hat x,\\
    \hat x  A+A^T\hat x=(\braces{\tr{A}I_{3\times 3}-A}x)^{\wedge},\label{eqn:xAAx}\\
R\hat x R^T = (Rx)^\wedge,\quad 
R(x\times y) = Rx\times Ry\label{eqn:RxR}
%,\label{eqn:Rxy}
\end{gather}
for any $x,y,z\in\Re^3$, $A\in\Re^{3\times 3}$ and $R\in\SO$. 
Throughout this paper, the dot product of two vectors is denoted by $x\cdot y = x^T y$ for any $x,y\in\Re^n$ and the maximum eigenvalue and the minimum eigenvalue of $J$ are denoted by $\lambda_M$ and $\lambda_m$, respectively. 
The 2-norm of a matrix \( A \) is denoted by \( \norm{A} \), and its Frobenius norm is denoted by \( \norm{A}_F = \tr{A^T A} \).
This results in \( \norm{A} \leq \norm{A}_F \leq \sqrt{r}\norm{A} \), where \( r \) is the rank of A.

\subsection{State Inequality Constraint}

The two-sphere is the manifold of unit-vectors in \( \R^3 \) such that \( \Sph^2 = \{ q \in \R^3 \,  \vert \, \norm{q} = 1 \}\).
We define \( r \in \Sph^2 \) to be a unit vector from the mass center of the rigid body and represented with respect to the body-fixed frame.
For example, \( r \) may represent the pointing direction of an on board optical sensor.
We define \( v \in \Sph^2 \) to be a unit vector from the mass center of the rigid body towards an undesired pointing direction and represented in the inertial reference frame.
For example, \( v \) may represent the inertial direction of a bright celestial object or the incoming direction of particles or other debris
It is further assumed that optical sensor has a strict non-exposure constraint with respect to the celestial object.
We formulate this hard constraint as
\begin{align}
	r^T R^T v \leq \cos \theta \, , \label{eqn:constraint}
\end{align}
where \( \ang{0} \leq \theta \leq \ang{90}  \) is the required minimum angular separation between \( r \) and \( R^T v \). 
The objective is to a determine a control input \( u \) that stabilizes the system from an initial attitude \( R_0 \) to a desired attitude \( R_d \) while ensuring that~\cref{eqn:constraint} is always satisfied.

\section{Attitude Control on $\SO$ with Inequality Constraints}
The first step in designing a control system on a nonlinear manifold \( \Q \) is the selection of a proper configuration error function.
This configuration error function, \( \Psi : \Q \times \Q \to \R \), is a smooth and proper positive definite function that measures the error between the current configuration and a desired configuration.
Once an appropriate configuration error function is chosen, one can then define a configuration error vector and a velocity error vector in the tangent space \( \mathsf{T}_q \Q \) through use of the derivatives of \( \Psi \)~\cite{bullo2004}.
With the configuration error function and vectors the remaining procedure is similar to nonlinear control design on Euclidean vector spaces.
One chooses control inputs as functions of the state through a Lyapunov analysis on \Q.

A new configuration error function is proposed for attitude control in the presence of state inequality constraints.
We extend the form used in~~\cite{bullo2004,lee2011a} for attitude control on \SO with the addition of a logarithmic barrier function.
We use the configuration error function to develop a nonlinear geometric attitude controller for the stabilization of a general rigid body. 
A smooth control system is first developed for the no disturbance case and then extended to include an adaptive update law for stabilization in the presence of unknown disturbances.

\begin{prop}[Attitude Error Function] \label{prop:config_error}
We assume a desired attitude command \( ( R_d, \Omega_d = 0 ) \), the current attitude and angular velocity \( ( R, \Omega) \), and a state constraint~\refeq{eqn:constraint} are given.
We define an attitude error function \( \Psi : \SO \times \SO \to \R \), and attitude error vector \( e_R : \SO \times \SO \to \R \), and an angular velocity error vector \( e_\Omega : \R^3 \to \R^3 \) as follows:
\begin{gather}
	\Psi(R) = A(R) B(R) \, , \label{eqn:psi} \\
	e_R = e_{R_A} B + A e_{R_B} \, , \label{eqn:eR} \\
	e_\Omega = \Omega \, , \label{eqn:eW}
\end{gather}
with
\begin{gather}
	A(R) = \frac{1}{2} \tr{G \left( I - R_d^T R\right)} \, , \label{eqn:A} \\
	B(R) = 1 - \frac{1}{\alpha} \ln \left( \frac{\cos \theta -  r^T R^T v}{1 + \cos \theta}\right) \, . \label{eqn:B} \\
	e_{R_A} = \frac{1}{2} \parenth{G R_d^T R - R^T R_d G} ^ \vee \, , \label{eqn:eRA} \\
	e_{R_B} = \frac{ \left( R^T v\right)^\vee r}{\alpha \left(r^T R^T v - \cos \theta \right)} \, . \label{eqn:eRB} 
\end{gather}	
where the matrix \( G \in \R^{3 \times 3} \) is defined as a diagonal matrix matrix for distinct, positive constants \( g_1, g_2, g_3 \in \R \).
Then, the following properties hold
\begin{enumerate}[(i)]
	\item \label{item:prop_psi_psd} \(\Psi\) is locally positive definite about \( R = R_d\)
	\item \label{item:prop_er} The variation of \( \Psi \) with respect to a variation of \( \delta R = R \hat{\eta} \) for \( \eta \in \R^3 \) is given by
	\begin{align}
		\dirDiff{\Psi}{R} &= \dirDiff{A}{R} \,  B(R) + A \,  \dirDiff{B}{R} \, . \\
	\end{align}
	\item \label{item:prop_era}The variation of \( A(R) \) with respect to a variation of \( \delta R = R \hat{\eta} \) for \( \eta \in \R^3 \) is given by
	\begin{align}
		\dirDiff{A}{R} &= \eta \cdot e_{R_A} \, .
	\end{align}
	\item \label{item:prop_erb} The variation of \( B(R) \) with respect to a variation of \( \delta R = R \hat{\eta} \) for \( \eta \in \R^3 \) is given by
	\begin{align}
		\dirDiff{B_i}{R} &= \eta \cdot e_{R_{B_i}} \, .
	\end{align}
	\item \label{item:prop_crit}The critical points of \( \Psi \),where \( e_R = 0\), are \( \braces{R_d} \cup \braces{R_d \exp(\pi \hat{s}} \) for \( s \in \braces{e_1, e_2, e_3} \) and \( R^T v = \pm r \).
	\item \label{item:prop_era_upbound}An upper bound of \( \norm{e_{R_A}} \) is given as:
	\begin{align}
		\norm{e_{R_A}}^2 \leq \frac{\Psi}{b_1} \, , \label{eqn:psi_lower_bound}
	\end{align}
	where the constant \( b_1 \) is given by \( b_1 = \frac{h_1}{h_2 + h_3} \) for 
	\begin{align*}
		h_1 &= \min{g_1 + g_2, g_2 + g_3 , g_3 + g_1} \, ,\\
		h_2 &= \min{\parenth{g_1 -g_2}^2,\parenth{g_2 -g_3}^2 , \parenth{g_3 -g_1}^2} \, ,\\
		h_3 &= \min{\parenth{g_1 + g_2}^2, \parenth{g_2 + g_3}^2 , \parenth{g_3 + g_1}^2} \, .				
	\end{align*}
\end{enumerate}
\end{prop}
\begin{proof}[Proof of~\Cref{prop:config_error}]\label{proof:config_error}
The proof of~\cref{item:prop_era_upbound} is available in~\cite{lee2011a}.
To prove~\cref{item:prop_psi_psd} we note that~\cref{eqn:A} is a locally positive definite function about \( R = R_d \)~\cite{bullo2004}.
The constraint angle is assumed \( \ang{0} \leq \theta \leq \ang{90} \) such that \( 0 \leq \cos \theta \).
The term \( r^T R^T v \) represents the cosine of the angle between the body fixed vector \( r \) and the inertial vector \( v \). 
It follows that
\begin{align*}
	0 \leq  \frac{\cos \theta -  r^T R^T v}{1 + \cos \theta} \leq 1 \, ,
\end{align*}
for all \( R \in SO \). 
As a result, the negative logarithm is always positive and
\begin{align*}
	1 < B \, .
\end{align*}
The product~\cref{eqn:psi} is composed of two positive terms and is therefore also positive definite, and has a single critical point at \( R = R_d \).

Next, we consider~\cref{item:prop_era}.
The variation of~\cref{eqn:A} is taken with respect to \( \delta R = R \hat \eta \) as
\begin{align*}
	\dirDiff{A}{R} &= -\frac{1}{2} \tr{G R_d^T \left( R \hat{\eta}\right)} \\
	&= \eta \cdot \frac{1}{2} \left( G R_d^T R - R^T R_d G\right)^\vee \, ,
\end{align*}
where we used~\cref{eqn:hat1}.

A straightforward application of the chain and product rules of differentiation allows us to show~\cref{item:prop_erb} as
\begin{align*}
	\dirDiff{B}{R} &= -\frac{1}{\alpha} \left[\left(\frac{1+\cos \theta}{\cos \theta - r^T R^T v} \right) \left(\eta \cdot \frac{\left( R^T v\right)^\vee r}{1+\cos \theta_i} \right) \right]  \\
	&= \eta \cdot \frac{ - \left( R^T v\right)^\vee r}{\alpha \left(\cos \theta - r^T R^T v \right)} \, ,
\end{align*}
where the scalar triple product~\cref{eqn:STP} was used.

To show~\cref{item:prop_crit}, we determine the critical points of~\cref{eqn:eRA}.
The attitude error between \( R \) and \( R_d \) is defined as \( Q \in SO \) as
\begin{align*}
	Q = R_d^T R = 
	\begin{bmatrix}
		q_{11} & q_{12} & q_{13} \\
		q_{21} & q_{22} & q_{23} \\
		q_{31} & q_{32} & q_{33}
	\end{bmatrix} \, .
\end{align*}
Equating \( e_{R_{A}} = 0 \) yields the following equivalent relations
\begin{subequations}
\begin{align}
	g_3 q_{32} &= g_2 q_{23} \, , \\
	g_1 q_{13} &= g_3 q_{31} \, , \\
	g_2 q_{21} &= g_1 q_{12} \, .
\end{align}
\end{subequations}
These relations allow one to redefine the attitude error \( Q \) in terms of the independent upper diagonal elements.
Noting that \( Q \in \SO \) is an orthonormal matrix, with unit length row and columns gives
\begin{subequations}
\begin{align}
	\parenth{1 - \frac{g_1^2}{g_2^2}} q_{12}^2 + \parenth{1 - \frac{g_1^2}{g_3^2}}q_{13}^2 &= 0 \, , \\
	\parenth{1 - \frac{g_1^2}{g_2^2}} q_{12}^2 - \parenth{1 - \frac{g_2^2}{g_3^2}} q_{23}^2 &= 0 \, , \\
	\parenth{1-\frac{g_1^2}{g_3^2}} q_{13}^2 + \parenth{1 - \frac{g_2^2}{g_3^2}} q_{23}^2 &= 0 \, .
\end{align}
\end{subequations}
As a result, all the off diagonal terms of \( Q = R_d^T R \), namely \( q_{12}= q_{13} = q_{23} = 0 \).
Since \( Q \in \SO \), the diagonal elements \( q_{11}, q_{22}, \text{ and } q_{33} \) are either \( +1 \) or \(-1\).
There are four critical points of \( e_{R_A} \), the desired attitude \( R_d \) as well as rotations about each body fixed axis by \ang{180}.
The repulsive error vector \( e_{R_{B}} \) is zero only when the numerator \( \parenth{R^T v}^\wedge r = 0 \). 
This condition only occurs if the desired attitude results in the body fixed vector \( r \) becoming aligned with \(R^T v \) while simultaneously satisfying \(\braces{R_d} \cup \braces{R_d \exp(\pi \hat{s}} \) for \( s \in \braces{e_1, e_2, e_3} \) .
The desired equilibrium is \( e_R = 0 \) and \( A = 0\).
\end{proof}

\Cref{eqn:psi} is composed of an attractive term \( A (R) \) and a repulsive term \( B(R) \).
The attractive error function has been used for attitude control on \SO.
In order to incorporate the state inequality constraints we apply a logarithmic barrier function term.
Barrier functions are typically used in optimal control and motion planning applications.
As the boundary of the constraint is neared, or \( r^T R^T v \to \cos \theta \), the barrier term increases, \( B \to \infty\).
The logarithmic function is popular as it quickly decays away from the constraint boundary.
The positive constant \( \alpha \) serves to shape the barrier function.
As \( \alpha \) is increased the impact of \( B(R) \) is reduced away from the constraint boundary. 
In addition, it is possible to incorporate an arbitrary number of state inequality constraints of the form given in~\cref{eqn:constraint}.
The configuration error function may be reformulated as \( \Psi = A \bracket{1 + \sum B_i} \) where \( B_i = B - 1 \).
In this manner, one may enforce multiple state inequality constraints on the control system.
\begin{prop}[Error Dynamics]\label{prop:error_dyn}
	The attitude error dynamics for \( \Psi, e_R, e_\Omega \) satisfy 
	\begin{gather}
		\diff{}{t} \parenth{\Psi} = e_R \cdot e_\Omega \, , \label{eqn:psi_dot}\\
		\diff{}{t} \parenth{e_R} = \dot{e}_{R_A} B + e_{R_A} \dot{B} + \dot{A}e_{R_B} + A \dot{e}_{R_B} \, , \label{eqn:eR_dot}\\
		\diff{}{t} \parenth{e_{R_A}} = E(R, R_d) e_\Omega \, , \label{eqn:eRA_dot} \\
		\diff{}{t} \parenth{e_{R_B}} = F(R) e_\Omega \, , \label{eqn:eRB_dot} \\
		\diff{}{t} \parenth{A} = e_{R_A} \cdot e_\Omega \, , \label{eqn:A_dot} \\
		\diff{}{t} \parenth{B} = e_{R_B} \cdot e_\Omega \, , \label{eqn:B_dot} \\
		\diff{}{t} \parenth{e_\Omega} = J^{-1} \parenth{-\Omega \times J \Omega + u + W(R, \Omega) \Delta} \, , \label{eqn:eW_dot}
	\end{gather}
	where the matrices \(E(R,R_d), F(R) \in \R^{3\times3} \) are given by
	\begin{gather}
		E(R,R_d) = \frac{1}{2} \parenth{\tr{R^T R_d G}I - R^T R_d G} \, , \label{eqn:E} \\
		F(R) = \frac{1}{\alpha \parenth{r^T R^T v - \cos \theta}} \left[\parenth{v^T R r} I - R^T v r^T + \right. \nonumber \\
		\left. \frac{R^T \hat{v} R r v^T R \hat{r}}{\parenth{r^T R^T v - \cos \theta}}\right] \, . \label{eqn:F}
	\end{gather}
\end{prop}
\begin{proof}[Proof of~\Cref{prop:error_dyn}]\label{proof:error_dyn}
From the kinematics~\cref{eqn:Rdot} and noting that \( \dot{R}_d = 0 \) the time derivative of \( R_d^T R \) is given as
\begin{gather*}
	\diff{}{t} \parenth{R_d^T R} = R_d^T R \hat{e}_\Omega \, .
\end{gather*}
Applying this to the time derivative of~\cref{eqn:A} gives
\begin{gather*}
	\diff{}{t} A = -\frac{1}{2} \tr{G R_d^T R \hat{e}_\Omega} \, .
\end{gather*}
Applying~\cref{eqn:hat1} into this shows~\cref{eqn:A_dot}.
Next, the time derivative of the repulsive error function is given by
\begin{gather*}
	\diff{}{t} B = \frac{r_i^T \parenth{\hat{\Omega} R^T} v_i}{\alpha \parenth{r_i^T R^T v_i - \cos \theta}} \, .
\end{gather*}
Using the scalar triple product, given by~\cref{eqn:STP}, one can reduce this to~\cref{eqn:B_dot}.
The time derivative of the attractive attitude error vector, \( e_{R_A} \), is given by
\begin{gather*}
	\diff{}{t} e_{R_A} = \frac{1}{2} \parenth{\hat{e}_\Omega R^T R_d G + (R^T R_d G)^T \hat{e}_\Omega}^\vee \, .
\end{gather*}
Using the hat map property given in~\cref{eqn:xAAx} this is further reduced to~\cref{eqn:eRA_dot,eqn:E}.

We take the time derivative of the repulsive attitude error vector, \( e_{R_B} \), as
\begin{gather*}
	\diff{}{t} e_{R_B} = a \Omega v^T R r - a R^T v \Omega^T r + b R^T \hat{v} R r \, ,
\end{gather*}
with \( a \in \R \) and \( b \in \R\) given by 
\begin{gather*}
	a = \bracket{\alpha \parenth{r^T R^T v - \cos \theta}}^{-1} \, ,
	b = \frac{r^T \hat{\Omega} R^T v}{\alpha \parenth{r^T R^T v - \cos \theta}^2} \, .
\end{gather*}
Using the scalar triple product from~\cref{eqn:STP} as \( r \cdot \Omega \times \parenth{R^T v} = \parenth{R^T v} \cdot r \times \Omega \) gives~\cref{eqn:eRB_dot,eqn:F}.

We show the time derivative of the configuration error function as
\begin{gather*}
	\diff{}{t} \Psi = \dot{A} B + A \dot{B} \, .
\end{gather*}
A straightforward substitution of~\cref{eqn:A_dot,eqn:B_dot,eqn:A,eqn:B} into this and appplying~\cref{eqn:eR} shows~\cref{eqn:psi_dot}.

The time-derivative of the angular velocity error, \( e_\Omega \), is given by
\begin{align*}
	\diff{}{t} e_\Omega &= \dot{\Omega} \\
	&= J^{-1} \parenth{u - \Omega \times J \Omega + W(R,\Omega) \Delta } \, ,
\end{align*}
where we have used the dynamic equations of motion from~\cref{eqn:Wdot}. 
\end{proof}

\subsection{Attitude Control without disturbance}
We introduce a nonlinear geometric controller for the attitude stabilization of a rigid body.
We assume that there is no disturbance, i.e., \( \Delta = 0 \).
\begin{prop}[Attitude Control]\label{prop:att_control}
	Given a desired attitude command \( \parenth{R_d, \Omega_d = 0} \) and positive constants \( k_R, k_\Omega \in \R \) we define a control input \( u \in \R^3 \) as follows
	\begin{gather}
		u = -k_R e_R - k_\Omega e_\Omega + \Omega \times J \Omega \, . \label{eqn:nodist_control}
	\end{gather}
	Then the zero equilibrium of the attitude errors \( \parenth{e_R, e_\Omega} \) is asymptotically stable, i.e., \(e_R, e_\Omega \to 0 \) as \( t \to \infty \).
\end{prop}

\begin{proof}[Proof of~\Cref{prop:att_control}]\label{proof:att_control}
	Consider the following Lyapunov function:
	\begin{gather}
		V = \frac{1}{2} e_\Omega \cdot J e_\Omega + k_R \Psi(R,R_d) \, . \label{eqn:v_nodist}
	\end{gather}
	From~\cref{item:prop_psi_psd}, we obtain
	\begin{gather*}
		V \geq 0 \, .
	\end{gather*}
	Using~\cref{eqn:eW_dot,eqn:psi_dot} with \( \Delta = 0 \), the time derivative of \( V \) is given by
	\begin{align}
		\dot{V} &= e_\Omega^T \parenth{ u - \Omega \times J \Omega } + k_R e_R \cdot e_\Omega \nonumber \\
		&= -k_\Omega \norm{e_\Omega}^2 \, . \label{eqn:vdot_nodist}
	\end{align}
	Since \( V \) is positive definite and \( \dot{V} \) is negative definite this implies that the zero equilibrium point \( e_R, e_\Omega \) is asymptotically stable.
\end{proof}

This proposition only guarantees that the attitude error vector \( e_R \) asymptotically converges to zero.
However, this does not necessarily show that \( R \to R_d \) as \( t \to \infty \). 
There are three additional critical points of \( \Psi \) where \( e_R = 0 \).
At an undesired equilibrium \( R = \exp{\pi \hat{e}_i} R_d \) and \( e_\Omega =0 \). 
This results in \( A \) having a value of \( g_1 + g_2, g_2 + g_3 \) or \( g_3 + g_1 \).
At any of these undesired equilibria we have \( V = k \). 
We define an augmented Lyapunov function as
\begin{align*}
	W = k - V = \frac{1}{2} e_\Omega \cdot J e_\Omega + k_R \parenth{\frac{k}{k_R}+ \Psi(R,R_d)} \, .
\end{align*}
We can choose an attitude \( R \) arbitrarily close to the equilibrium point \( \exp{ \pi \hat{e}_i} R_d \) such that the \( k_r \parenth{\frac{k}{k_R}+\Psi }> 0 \).
This is due to the fact that \( \Psi \) is positive definite about \( R = R_d \) as shown in~\cref{item:prop_psi_psd}.
If \( e_\Omega \) is sufficiently small this results in \( W > 0 \) and \( \dot{W} = -\dot{V} > 0\) from~\cref{eqn:vdot_nodist}.
According to Chateav's theorem the undesired equilibria are unstable~\cite{khalil1996}.
As a result, we can claim that the desired equilibrium \( R = R_d \text{ and } e_\Omega = 0 \) is almost globally asymptotically stable.

\subsection{Adaptive Control}
We extend the results of the previous section with the addition of a fixed but unknown disturbance \( \Delta \).
This scenario is typical of many mechanical systems and represents unmodeled dynamics or external moments acting on the system.
For example, Earth orbiting spacecraft typically experience both a torque due to a gravitational gradient as well as external torques to due solar radiation pressure.
Aerial vehicles will similarly experience external torques due to air currents or turbulence.
A smooth control system is introduced to asymptotically stabilize the system to a desired attitude while ensuring that state constraints are satisfied.

\begin{prop}[Bound on \( \dot{e}_R \)]\label{prop:eR_dot_bound}
Consider a domain \( D \) about the desired attitude defined as
\begin{align}
	D = \braces{R \in \SO \vert \Psi < \psi < h1, r^T R^T v < \beta < \cos \theta} \, . \label{eqn:domain}
\end{align}
Then the following statements hold:
\begin{enumerate}[(i)]
	\item \label{item:prop_eR_dot_bound_AB} Upper bounds of \( A(R) \) and \( B(R) \) are given by
	\begin{gather}
		\norm{A} < \psi \, , \label{eqn:A_bound}\\
		\norm{B} < \psi \, . \label{eqn:B_bound}
	\end{gather}
	\item \label{item:prop_eR_dot_bound_EF} Upper bounds of \( E(R,R_d) \) and \( F(R) \) are given by
	\begin{gather}
		\norm{E} \leq \frac{1}{\sqrt{2}} \tr{G} \, , \label{eqn:E_bound} \\
		\norm{F} \leq \frac{\parenth{\beta^2 + 1}\parenth{\beta - \cos \theta}^2 + 1 + \beta^2 \parenth{\beta^2-2}}{\alpha^2 \parenth{\beta-\cos \theta}^4} \, . \label{eqn:F_bound}
	\end{gather}
	\item Upper bounds of the attitude error vectors \( e_{R_A} \) and \( e_{R_B} \) are given by
	\begin{gather}
		\norm{e_{R_A}} \leq \sqrt{\frac{\psi}{b_1}} \, , \label{eqn:eRA_bound} \\
		\norm{e_{R_B}} \leq \frac{\sin\theta}{\alpha \parenth{\beta - \cos \theta}} \, . \label{eqn:eRB_bound}
	\end{gather}
\end{enumerate}
These results are combined to yield a maximum upper bound of the time derivative of the attitude error vector \( \dot{e}_R \) as
\begin{gather}
	\norm{\dot{e}_R} \leq H \norm{e_\Omega} \, ,\label{eqn:eR_bound}
\end{gather}
where  \( H \in \R \) is defined as
\begin{gather}
	H = \norm{B} \norm{E} + 2 \norm{e_{R_A}} \norm{e_{R_B}} + \norm{A}\norm{F}\, . \label{eqn:H}
\end{gather}
\end{prop}

\begin{proof}[Proof of~\Cref{prop:eR_dot_bound}]\label{proof:eR_dot_bound}
	We first show~\cref{item:prop_eR_dot_bound_AB} through a proof by contradiction by noting that given the selected domain \( D \) we know the configuration error function is bounded by \( \Psi = A(R) B(R) < \psi\).
	If we assume that \( A > \psi \) this means that \( B < 1 \) in order to satisfy the domain \( \Psi < \psi \).
	However, this would be in contradiction with~\cref{proof:config_error} as \( B > 1 \), therefore \( A \) must always be less than \( \psi \).
	Next, we show that since the domain \( D \) does not contain the constraint region there is an upper bound of \(B\).
	We know that \( B \to \infty \) as the constraint is neared. 
	We assume that \( B > \psi \) which implies that \( A < 1 \).
	As \( \psi \) is increased this means that the system is approaching the constraint and that \( A \to 0 \) in order to remain in the domain \( D \).
	However, since the chosen domain is assumed to exclude the constraint this situation is not possible and \( B < \psi \).
	This shows~\cref{item:prop_eR_dot_bound_AB}.
	
	Next, we show~\cref{item:prop_eR_dot_bound_EF} using the Frobenius norm.
	The Frobenius norm \( \norm{E}_F \) is given in~\cite{lee2011a} as
	\begin{gather*}
		\norm{E}_F = \sqrt{\tr{E^T E}} = \frac{1}{2} \sqrt{\tr{G^2} + \tr{R^T R_d G}^2} \, .
	\end{gather*}
	Applying Rodrigues' formula and the Matlab symbolic toolbox this is simplified to
	\begin{gather*}
		\norm{E}^2_F \leq \frac{1}{4} \parenth{\tr{G^2} + \tr{G}^2} \leq \frac{1}{2} \tr{G}^2 \, ,
	\end{gather*}
	which shows~\cref{eqn:E_bound}, since \( \norm{E} \leq \norm{E}_F \).
	
	To show~\cref{eqn:F_bound}, we apply the Frobenius norm \( \norm{F}_F \):
	\begin{align*}
		\norm{F}_F =& \sqrt{\tr{F^T F}} \\
		=& \frac{1}{\alpha ^2 \parenth{r^T R^T v - \cos \theta}^2} \left[\tr{a^T a} \right.\\
		& \left.- 2 \tr{a^T b} + 2 \tr{a^T c } + \tr{b^T b} \right. \\
		&\left. - 2 \tr{b^T c} + \tr{c^T c}\right] \, .
	\end{align*}
	where the terms \( a, b, \text{ and } c \) are given by
	\begin{gather*}
		a = r^T R r I \, ,\\
		b = R^T v r^T \, ,\\
		c = \frac{R^T \hat{v} R r v^T R \hat{r}}{r^T R^T v - \cos \theta}\, .
	\end{gather*}
	A straight forward computation of \( a^T a \) shows that
	\begin{gather*}
		\tr{a^T a} = \parenth{v^T R r}^2 \tr{I} \leq 3 \beta^2 \, ,
	\end{gather*}
	where we used the fact that \( v^T R r = r^T R^T v < \beta \) from our given domain.
	Similarly, one can show that \( \tr{a^T b} \) is equivalent to
	\begin{gather*}
		\tr{a^T b} = v^T R r \tr{R^T v r^T} = \parenth{v^T R r}^2 \leq \beta^2 \, ,
	\end{gather*} 
	where we used the fact that \( \tr{x y^T} = x^T y \).
	The product \( \tr{a^T c} \) is given by
	\begin{gather*}
		\tr{a^T c} = \frac{v^T R r}{r^T R^T v - \cos \theta} \tr{\parenth{R^T v}^\vee \parenth{r v^T R} \hat{r} } \, ,
	\end{gather*}
	where we used the hat map property~\cref{eqn:RxR}.
	One can show that \(\tr{a^T c} \leq 0 \) over the range \( -1 \leq v^T R r \leq \cos \theta \). 
	Next, \( \tr{b^T b}\) is equivalent to
	\begin{gather*}
		\tr{b^T b} = \tr{r v^T R R^T v r^T} = 1 \, ,
	\end{gather*}
	since \( r,v \in \Sph\).
	Finally, \( \tr{c^T c} \) is reduced to
	\begin{gather*}
		\tr{c^T c} = \tr{\hat{r} R^T v r^T \bracket{-I + R^T v v^T R} r v^T R \hat{r}} \, ,
	\end{gather*}
	where we used the fact that \( \hat{x}^2 = - \norm{x}^2 I + x x^T\).
	Expanding and collecting like terms gives
	\begin{gather*}
		\tr{c^T c } = \frac{1 - 2\parenth{v^T R r}^2 + \parenth{v^T R r}^4}{\parenth{r^T R^T v - \cos \theta}^2} \, . 
	\end{gather*}
	Using the the given domain \( r^T R^T v \leq \beta \) gives the upper bound~\cref{eqn:F_bound}.
	
	The bound on \( e_{R_A} \) is given in~\cref{eqn:psi_lower_bound} while \( e_{R_B} \) arises from the definition of the cross product \( \norm{a \times b} = \norm{a} \norm{b} \sin \theta \).
\end{proof}
\begin{prop}[Adaptive Attitude Control]\label{prop:adaptive_control}
Given  a desired attitude command \( R_d, \Omega_d = 0 \) and positive constants \( k_R, k_\Omega, k_\Delta, c \in \R \), we define a control input \( u \in \R^3\) and an adaptive update law for \( \bar{\Delta} \) as follows:
\begin{align}
	u &= - k_R e_R - k_\Omega e_\Omega + \Omega \times J \Omega - W \bar{\Delta} \, , \label{eqn:adaptive_control} \\
	\dot{\bar{\Delta}} &= k_\Delta W^T \parenth{e_\Omega + c e_R} \, . \label{eqn:delta_dot}
\end{align}
If \( c \) is chosen such that
\begin{gather}
	0 < c < \frac{4 k_R k_\Omega}{k_\Omega^2 + 4 k-R \lambda_M H} \, , \label{eqn:c_bound}
\end{gather}
  the zero equilibrium of the error vectors \( e_R, e_\Omega\) are asymptotically stable.
\end{prop}
\begin{proof}[Proof of~\cref{prop:adaptive_control}]\label{proof:adaptive_control}
	Consider the Lyapunov function \( V \) given by
	\begin{gather}
		V = \frac{1}{2} e_\Omega J e_\Omega + k_R \Psi + c J e_\Omega^T e_R + \frac{1}{2 k_\Delta} e_\Delta^T e_\Delta \, , \label{eqn:v_adapt}
	\end{gather}
	over the domain \( D \) in~\cref{eqn:domain}.
	From~\cref{prop:eR_dot_bound}, the Lyapunov function is bounded in \( D \) by
	\begin{gather}
		V \leq z^T W z \, , \label{eqn:v_upper_bound}
	\end{gather}
	where \( e_\Delta = \Delta - \bar{\Delta} \), \( z = \begin{bmatrix}e_R & e_\Omega & e_\Delta\end{bmatrix} \) and the matrix \(W \in \R^{3 \times 3}\) is given by
	\begin{gather*}
		W = \begin{bmatrix}
			k_R \psi & \frac{1}{2} c \lambda_M & 0 \\
			\frac{1}{2} c \lambda_M & \frac{1}{2} \lambda_M & 0 \\
			0 & 0 & \frac{1}{2 k_\Delta}
		\end{bmatrix} \, .
	\end{gather*}
	The time derivative of with the control inputs~\cref{eqn:adaptive_control} is defined as
	\begin{align}
		\dot{V} =& - k_\Omega e_\Omega^T e_\Omega + \parenth{e_\Omega + c e_R}^T W e_\Delta - k_R c e_R^T e_R \nonumber\\
		&- k_\Omega c e_R^T e_\Omega + c J e_\Omega^T \dot{e}_R - \frac{1}{k_\Delta} e_\Delta^T \dot{\bar{\Delta}} \, , \label{eqn:vdot}
	\end{align}
	where we used \( \dot{e}_\Delta = - \dot{\bar{\Delta}} \).
	The terms linearly dependent on \( e_\Delta\) are combined with~\cref{eqn:delta_dot} to yield
	\begin{align*}
		 e_\Delta^T \parenth{W^T \parenth{e_\Omega + c e_R} - \frac{1}{k_\Delta} \dot{\bar{\Delta}}} = 0 \, . 
	\end{align*}
	Using~\Cref{prop:eR_dot_bound} an upper bound on \( \dot{V} \) is written as
	\begin{gather*}
		\dot{V} \leq -z^T M z \, ,
	\end{gather*}
	where the matrix \( M \in \R^{2 \times 2} \) is 
	\begin{gather}
		M = \begin{bmatrix}
			k_R c & \frac{k_\Omega c}{2} \\
			\frac{k_\Omega c}{2} & k_\Omega - c \lambda_M H
		\end{bmatrix} \, .
	\end{gather}
	If \( c \) is chosen such that~\cref{eqn:c_bound} is satisfied the matrix \( M \) is positive definite.
	This implies that the zero equilibrium \( e_R, e_\Omega\) is asymptotically stable. 
	The domain \( D \) does that include the undesired equilibria and ensures that as \( e_R \to 0 \) the attitude also converges \( R \to R_d \).
\end{proof}
Nonlinear adaptive controllers have been developed for attitude stabilization in terms of modified Rodriguez parameters and quaternions, as well as attitude tracking in terms of Euler angles. 
The proposed control system is developed on \(\SO\) and avoids the singularities of Euler angles and Rodriguez parameters while incorporating state inequality constraints. 
In addition, the unwinding and double coverage ambiguity of quaternions are also completely avoided. 

\section{Numerical Examples}
We demonstrate the performance of the proposed control system via numerical simulation.
The inertia tensor of a rigid body is given as
\begin{gather*}
	J = \begin{bmatrix}
	\num{5.571e-3} & \num{6.177e-5} & \num{-2.503e-5} \\
	\num{6.177e-5} & \num{5.571e-3} & \num{1.001e-5} \\
	\num{-2.503e-5} & \num{1.007e-5} & \num{1.051e-2}
	\end{bmatrix} \, .
\end{gather*} 
The control system parameters are chosen as
\begin{gather*}
	G = \text{diag} \parenth{0.9,1.1,1.0}\, , \quad k_R = 0.4 \, , \quad	k_\Omega = 0.296 \, ,\\
	c = 1.0 \, , \quad k_\Delta = 0.5 \, , \quad \alpha = 15 \, .
\end{gather*}
A body fixed sensor is defined as
\begin{gather*}
	r = \begin{bmatrix} 1 & 0 & 0 \end{bmatrix} \, ,
\end{gather*}
while multiple inequality constraints are defined in~\cref{tab:constraints}.
The simulation parameters are chosen to emulate those found in~\cite{lee2011b}.
\begin{table}[htbp]
\begin{center}\begin{tabular}{lc}
Constraint Vector & Angle \\ \hline \hline 
\(\begin{bmatrix} 0.174 &-0.934 & -0.034 \end{bmatrix}\) & \ang{40} \\ \hline 
\(\begin{bmatrix} 0 & 0.7071 & 0.7071 \end{bmatrix}\) & \ang{40} \\ \hline 
\(\begin{bmatrix} -0.853 & 0.436 & -0.286 \end{bmatrix}\) & \ang{40} \\ \hline 
\(\begin{bmatrix} -0.122 -0.140 -0.983 \end{bmatrix}\) & \ang{20}\end{tabular} 
\caption{Simulation Parameters}
\end{center}
\label{tab:constraints}
\end{table}
The initial and desired states are defined using Euler angles as~\cite{shuster1993},
\begin{gather*}
	R(0) = I \, , \quad \Omega(0) = 0 \, ,\\
	R_d = \text{ROT3}(\ang{225}) \, , \quad \Omega_d = 0 \, .
\end{gather*}

We show simulation results for the system stabilizing about the desired attitude with and without the adaptive update law from~\Cref{prop:adaptive_control}
We assume a fixed disturbance of 
\begin{gather*}
	\Delta = \begin{bmatrix} 0.06 & 0.06 & 0.09 \end{bmatrix}^T \, ,
\end{gather*}
with the function \( W(R,\Omega) = I \).
This form is equivalent to an integral control term which penalizes deviations from the desired configuration.
\begin{figure} 
	\centering 
	\begin{subfigure}[htbp]{0.5\columnwidth} 
		\includegraphics[width=\columnwidth]{eR_con} 
		\caption{Attitude error vector \(e_R\) } \label{fig:eR_con} 
	\end{subfigure}~ %add desired spacing between images, e. g. ~, \quad, \qquad, \hfill etc. %(or a blank line to force the subfigure onto a new line) 
	\begin{subfigure}[htbp]{0.5\columnwidth} 
		\includegraphics[width=\columnwidth]{Psi_con} 
		\caption{Configuration error \( \Psi \)} \label{fig:Psi_con} 
	\end{subfigure}
	
	\begin{subfigure}[htbp]{0.5\columnwidth} 
		\includegraphics[width=\columnwidth]{u_con} 
		\caption{Control input \( u\)} \label{fig:u_con} 
	\end{subfigure}~
	\begin{subfigure}[htbp]{0.5\columnwidth}
		\includegraphics[width=\columnwidth]{cad}
		\caption{Trajectory in inertial frame\label{fig:cad}}
	\end{subfigure}
	\caption{Attitude stabilization without adaptive update law}
	\label{fig:con} 
\end{figure}

\begin{figure} 
	\centering 
	\begin{subfigure}[htbp]{0.5\columnwidth} 
		\includegraphics[width=\columnwidth]{eR_adapt} 
		\caption{Attitude error vector \(e_R\) } \label{fig:eR_adapt} 
	\end{subfigure}~ %add desired spacing between images, e. g. ~, \quad, \qquad, \hfill etc. %(or a blank line to force the subfigure onto a new line) 
	\begin{subfigure}[htbp]{0.5\columnwidth} 
		\includegraphics[width=\columnwidth]{Psi_adapt} 
		\caption{Configuration error \( \Psi \)} \label{fig:Psi_adapt} 
	\end{subfigure}
	
	\begin{subfigure}[htbp]{0.5\columnwidth} 
		\includegraphics[width=\columnwidth]{u_adapt} 
		\caption{Control input \( u\)} \label{fig:u_adapt} 
	\end{subfigure}~	
	\begin{subfigure}[htbp]{0.5\columnwidth} 
		\includegraphics[width=\columnwidth]{Delta_adapt} 
		\caption{Disturbance estimate \( \bar{\Delta}\)} \label{fig:Delta_adapt} 
	\end{subfigure}
	\caption{Attitude stabilization with adaptive update law}
	\label{fig:adapt} 
\end{figure}

Simulation results without the adaptive update law are shown in~\cref{fig:con}.
Without the update law, the system does not achieve zero steady state error. 
\Cref{fig:Psi_con} shows that the configuration error function does not converge to zero.
\Cref{fig:adapt} shows the results with the addition of the adaptive update law.

The path of the body fixed sensor in the inertial frame is illustrated in~\cref{fig:cad}.
The initial attitude is represented with the green circle while the final attitude is marked with a green \(\times\).
The control system is able to asymptotically converge to zero attitude error.
In addition, the estimate of the disturbance converges to the the true value.
Both control system are able to automatically avoid the constrained regions. 
In addition, these results show that it is straightforward to incorporate an arbitrary amount of large constraints.
In spite of this challenging configuration space the proposed control system offers a simple method of avoiding constrained regions.
These closed-loop feedback results are computed in real time and offer a significant advantage over typical open-loop planning methods.
These results show that the proposed geometric adaptive approach is critical to attitude stabilization in the presence of state constraints and disturbances.

\section{Experiment on Hexrotor UAV}

A hexrotor unmanned aerial vehicle (UAV) has been developed at the Flight Dynamics and Controls Laboratory(FDCL) at the George Washington University.
The UAV is composed of three pairs of counter-rotating propellers. 
Typical quadrotor UAVs are composed of four or more co-planar propellers.
As a result, these systems are underactuated and unable to impart a force along every degree of freedom.
For example, quadrotor UAVs are unable to translate laterally without first conducting a rotation.
Conversely, the propeller pairs of the hexrotor are angled relative to one another to allow for a fully actuated rigid body.
This allows the hexrotor to impart a force in any direction and a moment about any axis. 

The hexrotor UAV is composed of the following hardware:
\begin{itemize}
	\item Onboard ODROID XU3 Linux processor.
	\item VectorNav VN100 IMU operating at over \SI{100}{\hertz} via TTL serial 
	\item Brushless DC Motors powered by BL-Ctrl-2.0 speed controllers via I2C.
	\item Position and attitude over WiFi (TCP) communication from Vicon motion capture system via host computer.
	\item Commands sent over WiFi through the terminal (SSH) to the code running onboard the hexrotor. 
\end{itemize}
In order to constrain the motion and test only the attitude dynamics we attach the hexrotor to a spherical joint.
The center of rotation is below the center of gravity of the hexrotor.
As a result, there is a destabilizing gravitational moment and the resulting attitude dynamics is similar to an inverted pendulum model.
We augment the control input in~\cref{eqn:adaptive_control} with an additional term to negate the effect of the gravitational moment.

\begin{figure}
	\includegraphics[width = \columnwidth]{hexrotor}
	\caption{Attitude control testbed~\label{fig:hexrotor}}
\end{figure}
A sensor pointing direction is defined in the body frame of the hexrotor as \( r = \begin{bmatrix} 1 & 0 & 0 \end{bmatrix}^T \).
We define an obstacle in the inertial frame as \( v = \begin{bmatrix} \frac{1}{\sqrt{2}} & \frac{1}{\sqrt{2}} & 0\end{bmatrix}^T \) with \( \theta = \ang{12} \).
An initial and desired attitude are defined in terms of Euler angles as
\begin{gather}
	R(0) = \text{ROT3}(\ang{90}) \, , \quad R_d = \text{ROT3}(\ang{0})=I \, .
\end{gather}                                
This results in the sensor performing a \ang{90} yaw rotation about the vertical axis of the spherical joint.
The attitude control system is identical to the one presented in~\cref{prop:adaptive_control} except the addition of a gravity moment term and the following parameters
\begin{gather*}
	k_R = 0.4 \, , \quad k_\Omega = 0.7 \, , c = 0.1 \\
	\alpha = 8 \, , k_\Delta = 0.05 \, .
\end{gather*}
\begin{figure} 
	\centering 
	\begin{subfigure}[htbp]{0.5\columnwidth} 
		\includegraphics[width=\columnwidth]{eR_exp} 
		\caption{Attitude error vector \(e_R\) } \label{fig:eR_exp} 
	\end{subfigure}~ %add desired spacing between images, e. g. ~, \quad, \qquad, \hfill etc. %(or a blank line to force the subfigure onto a new line) 
	\begin{subfigure}[htbp]{0.5\columnwidth} 
		\includegraphics[width=\columnwidth]{Psi_exp} 
		\caption{Configuration error \( \Psi \)} \label{fig:Psi_exp} 
	\end{subfigure}
	
	\begin{subfigure}[htbp]{0.5\columnwidth} 
		\includegraphics[width=\columnwidth]{u_exp} 
		\caption{Control input \( u\)} \label{fig:u_exp} 
	\end{subfigure}~
	\begin{subfigure}[htbp]{0.5\columnwidth} 
		\includegraphics[width=\columnwidth]{traj_exp} 
		\caption{Attitude Trajectory} \label{fig:traj_exp} 
	\end{subfigure}
	\caption{Constrained Attitude stabilization experiment}
	\label{fig:exp} 
\end{figure}
The experimental results are shown in~\Cref{fig:exp}.
Overall it behaves as the numerical simulations predicted.
The attitude errors asymptotically converge to zero. 
In addition, as the constraint is neared an out-of-plane moment is used to avoid the constrained region.
An increased gain of the adaptive update law would improve the final steady state error performance.
A video clip showing the attitude manuever is available LINK.
\section{Conclusion}\label{sec:conclusion}
We have developed a geometric adaptive control system which incorporates state inequality constraints on \SO.
The presented control system is developed directly on \SO and avoids singularities and ambiguities that are inherent to attitude parameterizations.
An adaptive control system is developed to asymptotically converge to a desired attitude while avoiding constraints in the presence of disturbances.
In addition we have demonstrated the control system via numerical simulation and hardware experiments on a hexrotor UAV.
A novel feature of this control is that it is computed autonomously on-board the UAV.
This is in constrast to many state constrained attitude control systems which require an a priori attitude trajectory to be calculated. 
The presented method is simple, efficient and ideal for hardware implementation on embedded systems.



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\appendix


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\addtolength{\textheight}{-12cm}   % This command serves to balance the column lengths
                                  % on the last page of the document manually. It shortens
                                  % the textheight of the last page by a suitable amount.
                                  % This command does not take effect until the next page
                                  % so it should come on the page before the last. Make
                                  % sure that you do not shorten the textheight too much.
                                  
\bibliography{BibMaster,library}
\bibliographystyle{IEEEtran}

\end{document}
